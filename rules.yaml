# Day 2 rule set: evidence-aware, ontology-aware scoring
rules:
  - id: type_domain_range_valid
    description: Domain/range matches expected biomedical categories
    weight: 0.8
    when:
      all:
        - fact: type.domain_valid
          op: equals
          value: true
        - fact: type.range_valid
          op: equals
          value: true
    because: "because the subject ({type.domain_category}) -> object ({type.range_category}) relation is allowed"

  - id: type_domain_range_violation
    description: Domain/range invalid for predicate
    weight: -1.2
    when:
      any:
        - fact: type.domain_valid
          op: equals
          value: false
        - fact: type.range_valid
          op: equals
          value: false
    because: "because the subject/object categories are incompatible ({type.domain_category} -> {type.range_category})"

  - id: ontology_closure_hpo
    description: Entities carry ontology ancestry (HPO/MONDO/etc)
    weight: 0.4
    when:
      any:
        - fact: ontology.subject_has_ancestors
          op: equals
          value: true
        - fact: ontology.object_has_ancestors
          op: equals
          value: true
    because: "because ontology closure was available for at least one entity"

  - id: retraction_gate
    description: Fail hard if any supporting citation is retracted
    weight: -1.5
    when:
      any:
        - fact: evidence.retracted_count
          op: gt
          value: 0
    because: "because one or more citations are retracted: {evidence.retracted}"

  - id: expression_of_concern
    description: Down-weight citations marked as expressions of concern
    weight: -0.5
    when:
      any:
        - fact: evidence.concern_count
          op: gt
          value: 0
    because: "because some citations have expressions of concern: {evidence.concerns}"

  - id: multi_source_bonus
    description: Reward multiple independent sources
    weight: 0.3
    when:
      all:
        - fact: evidence.has_multiple_sources
          op: equals
          value: true
    because: "because the claim cites multiple sources ({claim.citation_count})"

  - id: minimal_evidence
    description: Require at least one supporting citation
    weight: -0.6
    when:
      any:
        - fact: claim.citation_count
          op: lte
          value: 0
    because: "because no PMIDs/DOIs were supplied"
