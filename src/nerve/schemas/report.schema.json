{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://nerve.github.io/schemas/report.schema.json",
  "title": "SkepticReport",
  "description": "Structured audit report from the NERVE tool",
  "type": "object",
  "required": ["task_id", "agent_name", "summary", "claims", "findings"],
  "properties": {
    "task_id": {
      "type": "string",
      "description": "Unique identifier for the audit task"
    },
    "agent_name": {
      "type": "string",
      "description": "Name of the agent under audit"
    },
    "summary": {
      "type": "string",
      "description": "Human-readable summary of the audit results"
    },
    "claims": {
      "type": "array",
      "description": "Atomic claims extracted from the agent output",
      "items": { "$ref": "#/$defs/Claim" }
    },
    "findings": {
      "type": "array",
      "description": "Issues and observations from the audit",
      "items": { "$ref": "#/$defs/Finding" }
    },
    "suggested_fixes": {
      "type": "array",
      "description": "Recommended repairs for findings",
      "items": { "$ref": "#/$defs/SuggestedFix" },
      "default": []
    },
    "stats": {
      "type": "object",
      "description": "Summary statistics from the audit",
      "properties": {
        "total_claims": { "type": "integer" },
        "total_findings": { "type": "integer" },
        "findings_by_severity": {
          "type": "object",
          "additionalProperties": { "type": "integer" }
        },
        "findings_by_kind": {
          "type": "object",
          "additionalProperties": { "type": "integer" }
        },
        "entities_normalized": { "type": "integer" },
        "entities_unresolved": { "type": "integer" }
      },
      "additionalProperties": true
    }
  },
  "$defs": {
    "Severity": {
      "type": "string",
      "enum": ["info", "warning", "error", "blocker"],
      "description": "Severity level of a finding"
    },
    "EntityMention": {
      "type": "object",
      "description": "A mention of a biomedical entity with optional normalization",
      "required": ["mention"],
      "properties": {
        "mention": {
          "type": "string",
          "description": "The text span of the entity mention"
        },
        "norm_id": {
          "type": ["string", "null"],
          "description": "Normalized identifier (e.g., HGNC:1234, GO:0001234)"
        },
        "norm_label": {
          "type": ["string", "null"],
          "description": "Canonical label from the ontology/database"
        },
        "source": {
          "type": "string",
          "description": "Provenance of the normalization",
          "enum": ["rule", "llm", "dictionary", "manual", "unknown"],
          "default": "unknown"
        },
        "metadata": {
          "type": "object",
          "description": "Additional entity metadata",
          "additionalProperties": true
        }
      }
    },
    "Claim": {
      "type": "object",
      "description": "An atomic claim extracted from the agent output",
      "required": ["id", "text"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the claim"
        },
        "text": {
          "type": "string",
          "description": "The claim text"
        },
        "entities": {
          "type": "array",
          "description": "Biomedical entities mentioned in the claim",
          "items": { "$ref": "#/$defs/EntityMention" },
          "default": []
        },
        "support_span": {
          "type": ["string", "null"],
          "description": "Source snippet or reference supporting this claim"
        },
        "evidence": {
          "type": "array",
          "description": "Citations, PMIDs, or tool outputs as evidence",
          "items": { "type": "string" },
          "default": []
        },
        "metadata": {
          "type": "object",
          "description": "Additional claim metadata",
          "properties": {
            "confidence": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "extraction_method": {
              "type": "string",
              "enum": ["rule", "llm", "hybrid"]
            },
            "source_turn": { "type": "integer" }
          },
          "additionalProperties": true
        }
      }
    },
    "SuggestedFix": {
      "type": "object",
      "description": "A minimal edit or tool action to repair a finding",
      "required": ["patch", "rationale"],
      "properties": {
        "target_claim_id": {
          "type": ["string", "null"],
          "description": "ID of the claim this fix applies to"
        },
        "patch": {
          "type": "string",
          "description": "Human-readable minimal change or tool call suggestion"
        },
        "rationale": {
          "type": "string",
          "description": "Explanation of why this fix is recommended"
        },
        "confidence": {
          "type": "number",
          "description": "Confidence score for this fix",
          "minimum": 0,
          "maximum": 1,
          "default": 0
        },
        "metadata": {
          "type": "object",
          "additionalProperties": true
        }
      }
    },
    "Finding": {
      "type": "object",
      "description": "A critique item produced by the nerve",
      "required": ["id", "kind", "severity", "message"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the finding"
        },
        "kind": {
          "type": "string",
          "description": "Category of the finding",
          "enum": [
            "ontology_violation",
            "missing_evidence",
            "contradiction",
            "unnormalized_entity",
            "impossible_relation",
            "missing_qualifier",
            "taxon_mismatch",
            "evidence_insufficient",
            "deprecated_term",
            "ambiguous_entity",
            "other"
          ]
        },
        "severity": { "$ref": "#/$defs/Severity" },
        "message": {
          "type": "string",
          "description": "Human-readable description of the issue"
        },
        "claim_id": {
          "type": ["string", "null"],
          "description": "ID of the related claim, if applicable"
        },
        "provenance": {
          "type": "object",
          "description": "Details about how this finding was determined",
          "properties": {
            "rule_id": { "type": "string" },
            "rule_name": { "type": "string" },
            "kg_source": { "type": "string" },
            "kg_query": { "type": "string" },
            "evidence_ids": {
              "type": "array",
              "items": { "type": "string" }
            }
          },
          "additionalProperties": true
        },
        "suggested_fix": {
          "oneOf": [
            { "$ref": "#/$defs/SuggestedFix" },
            { "type": "null" }
          ],
          "description": "Inline suggested fix for this specific finding"
        }
      }
    }
  }
}
